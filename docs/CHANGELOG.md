# 🔄 更新日志

本文档记录了 X 搜索增强插件主要版本的变更历史。

## v1.3.0 (内部代号: "UI Refresh & Persistence Boost" - 2025-06-03)
* ✨ **新功能与重要优化**:

    * **面板布局优化**:

        * 重新设计了插件面板的内部布局，确保**“开始搜索”按钮始终固定在面板底部**，在任何情况下都清晰可见并易于操作。

        * 面板的主要内容区域（包括搜索框、高级筛选、特别关注列表）现在可以独立滚动。

    * **高级筛选 UI 优化**:

        * 移除了原有的日期范围选择器。

        * 新增 **“今日内容”筛选按钮**（图标+文字），一键筛选当天的推文。

        * 将原有的布尔型筛选条件（认证用户、包含图片、包含视频、包含链接、排除回复）从复选框改为更直观的 **图标+文字按钮**形式，点击即可切换选中状态。

        * 语言筛选继续使用下拉选择框，但其外观已优化得更像按钮，与新的筛选按钮风格保持一致。

    * **状态持久化增强**:

        * **高级筛选条件持久化**: 用户设置的所有高级筛选条件（包括各个按钮的选中状态、语言选择）现在都会被保存，并在下次打开面板时自动恢复。

        * **高级筛选面板展开/收起状态持久化**: 用户展开或收起高级筛选区域的状态也会被记住。

        * **特别关注列表展开/收起状态持久化**: 特别关注列表的“显示更多/收起”状态现在也会被保存和恢复。

    * **特别关注列表优化**:

        * 列表上方的用户数量徽章现在也是一个 **可交互的按钮**，用于控制列表的“显示更多/收起”功能（当用户数超过预设值时）。

        * 列表中的用户项显示调整为两行：第一行为用户昵称（或用户名），第二行为 `@username`。

* 🎨 **UI与UX改进**:

    * 统一了“高级筛选”切换按钮与“特别关注”区域标题的 **文本样式**（字体大小、粗细），视觉更协调。

    * 优化了当高级筛选区域收起时，其与下方“特别关注”模块之间的 **垂直间距**，使布局更紧凑美观。

* 🐛 **问题修复**:

    * 解决了在设置高级筛选条件并执行搜索后，返回面板时这些条件被意外清空的问题。

    * 解决了高级筛选面板在用户未主动操作的情况下，重新打开时会意外收起的问题。

    * 解决了特别关注用户列表的展开状态在页面跳转或面板重开后未被正确恢复的问题。


## v1.2.0 (内部代号: "Precision Search Update" - 2025-06-02)

* ✨ **新功能: 集成高级搜索筛选条件**
    * 在搜索面板中增加了可展开/收起的“高级筛选”区域，提供更精细的搜索控制。

    * 支持按 **指定用户 (`from:username`)** 搜索（此功能在“特别关注”列表未激活用于搜索时可用，避免逻辑冲突）。

    * 支持按 **日期范围 (`since:YYYY-MM-DD`, `until:YYYY-MM-DD`)** 进行筛选，提供日期选择器。

    * 支持按 **内容类型** 筛选：
        * 认证用户 (`filter:verified`)

        * 包含图片 (`filter:images`)

        * 包含视频 (`filter:videos`)

        * 包含链接 (`filter:links`)

    * 支持按 **语言 (`lang:code`)** 筛选（预设中文、英语、日语、韩语选项，及任意语言）。

    * 支持 **排除回复 (`-filter:replies`)**，以便更关注原创内容。

* 🔧 **功能改进与优化 (高级搜索相关)**:
    * **智能交互**: 当“特别关注”列表被用于搜索时，高级筛选中的“指定用户”输入区域会自动隐藏，以提供更清晰的用户体验。

    * **状态持久化**: 高级筛选条件的展开/收起状态以及各个筛选字段的当前值（如日期、勾选项、语言选择等）现在会通过 `chrome.storage.local` 进行持久化存储，方便用户下次使用时恢复设置。

    * **便捷操作**: 新增“清除筛选”按钮，允许用户一键重置所有高级筛选条件到默认状态。

    * **日期校验**: 实现了对日期范围输入的有效性校验（例如，开始日期不能晚于结束日期），并在无效时给出提示。

    * **代码结构优化**: 对 `content_script.js` 进行了进一步的模块化处理，将高级筛选UI的动态生成、事件绑定和逻辑处理封装得更为清晰。

    * **样式增强**: 在 `content_styles.css` 中为新增的高级筛选区域添加了美观且符合整体风格的样式，并实现了平滑的展开/收起动画效果。

* 🐛 **问题修复**:
    * 修复了在某些特定 X.com 页面布局下，特别关注星标按钮可能定位不准确的问题。

    * 改进了对 X.com 动态加载内容的处理，提高了徽章和按钮在SPA导航后的稳定性。

    * (如果针对此版本修复的其他小问题，可在此列出)

## v1.1.0 (内部代号: "Robustness & Stability Update" - 2025-06-02)

* **模块 1: 健壮的DOM交互层**
    * 引入 `DOM_SELECTORS` 对象，集中管理所有CSS选择器，便于维护和应对X.com的UI变更。

    * 实现 `findElementAdvanced` 高级元素查找函数，利用 `MutationObserver` 动态等待元素加载，取代了不可靠的固定延时，显著提高了在动态页面上定位元素的成功率。

* **模块 2: 动态内容加载处理器**
    * 优化了插件的初始化逻辑 (`initializeExtension`)，确保在页面关键内容区域（如 `main[role="main"]`）加载完成后再启动核心功能，增强了插件在不同加载速度和页面结构下的稳定性。

* **模块 3: 一致的面板状态和生命周期管理**
    * 实现了 `setPanelOpenState` 函数，统一管理搜索面板的打开/关闭状态及其在 `chrome.storage.local` 中的持久化。

    * 优化了面板在单页应用（SPA）导航和页面刷新时的状态恢复逻辑，确保用户体验的一致性。

* **模块 4: `addUserProfileButton` 功能增强**
    * 改进了 `isUserProfilePage` 函数，通过更精确的正则表达式和排除列表来识别用户个人资料页并提取用户名。

    * 确保只在正确的用户个人资料页添加“特别关注”星标按钮，并在导航离开时能有效清理可能残留的旧按钮。

* **模块 5: CSS 策略优化**
    * 审查并优化了 `content_styles.css`，通过提高选择器特异性等方法，减少了不必要的 `!important` 声明，使样式更易于管理和覆盖，同时保留了确保UI稳定性的关键 `!important` 规则。

* **模块 6: Manifest 文件清理**
    * 对 `manifest.json` 文件进行了审查和清理，移除了 `web_accessible_resources` 中可能存在的未使用文件声明，遵循了最小配置原则。

* **模块 7: Service Worker - 内容脚本通信优化**
    * 改进了 `service_worker.js` 与 `content_script.js` 之间的通信机制。

    * 利用 Promise 和异步逻辑更健壮地处理脚本注入的尝试、成功与否以及消息的发送和响应。

    * 增加了对目标标签页有效性的检查，并优化了脚本注入后的消息发送时机。

* **其他**:
    * 修复了若干在特定条件下可能出现的小 Bug。

    * 提升了代码的整体稳定性和可维护性，为后续功能迭代打下了更好的基础。

## v1.0.0 (初始版本)

* 🎉 **首次发布**: 实现 X 搜索增强插件的核心 MVP (Minimum Viable Product) 功能。

* ⭐ **特别关注管理**:
    * 支持在用户主页快速添加或移除特别关注用户。

    * 在插件面板中提供特别关注用户列表的查看和管理功能。

    * 点击列表用户可跳转至其主页。

* 🔍 **智能搜索**:
    * 支持在插件面板中输入关键词进行搜索。

    * 可选择将搜索范围限定在特别关注用户所发布的内容。

    * 自动构建精确搜索查询并跳转到 X.com 结果页。

* 🎯 **视觉识别**:
    * 在 X.com 搜索结果中，为特别关注用户的推文添加星标徽章。

* 🎨 **Apple Design风格界面**:
    * 引入现代化、简洁的用户界面设计，借鉴 Apple Design 语言。

    * 包含毛玻璃效果、流畅动画等视觉元素。

* 🌙 **深色模式支持**:
    * 插件界面能够自动适应操作系统的深色或浅色主题设置。

* 📱 **响应式设计**:
    * 对插件面板进行了初步的响应式设计，以适应不同屏幕尺寸。
    
* 🚀 **Manifest V3**:
    * 基于最新的浏览器扩展标准 (Manifest V3) 构建，注重安全性和性能。