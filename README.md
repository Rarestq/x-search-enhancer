# X 搜索增强浏览器插件 (X Search Enhancer)
一个专为 X (Twitter) 设计的浏览器插件，旨在增强其搜索功能，并提供更便捷的特别关注用户管理体验。

## ✨ 功能特性
### 🔍 智能搜索
- **关键词搜索**: 在专用面板中输入关键词进行搜索。

- **特别关注筛选**: 可选择将搜索范围限制在您特别关注的用户所发布的内容。

- **一键搜索**: 自动构建精确的搜索查询并跳转到 X.com 的结果页面。

### ⭐ 特别关注用户管理
- **快速添加/移除**: 在任何用户主页，通过点击用户名旁边的星标按钮（☆/⭐）即可轻松添加或移除特别关注。

- **用户列表**: 在搜索面板中清晰展示和管理所有特别关注用户。

- **快速访问**: 点击列表中的用户项，可直接跳转到该用户的主页。

- **面板状态持久化**: 搜索面板的打开/关闭状态会被记住，在下次访问 X.com 时会自动恢复。

### 🚀 高级搜索筛选

- **精细化搜索条件**: 在主关键词搜索的基础上，提供一组可展开/收起的高级筛选条件，让您的搜索更精准。

- **多种筛选操作符支持**:

    - **指定用户** (`from:username`): 从特定用户发布的推文中搜索（当“特别关注”列表未激活时可用）。
    
    - **日期范围** (`since:YYYY-MM-DD` 和 `until:YYYY-MM-DD`): 限定搜索结果的时间区间。
    
    - **内容类型**:
        - **认证用户** (`filter:verified`): 只搜索来自认证用户的推文。

        - **媒体内容**: 筛选包含图片 (`filter:images`) 或视频 (`filter:videos`) 的推文。

        - **链接** (`filter:links`): 筛选包含链接的推文。
        
        - **语言** (`lang:code`): 筛选特定语言的推文（支持中文、英语、日语、韩语）。
        
        - **排除回复** (`-filter:replies`): 在搜索结果中排除回复类型的推文。
    
    - **智能交互**:
        - 当“特别关注”列表激活时，高级筛选中的“指定用户”选项会自动隐藏，避免冲突。
        
        - 高级筛选条件的当前状态（包括展开/收起状态和各筛选值）会被记住，方便下次使用。
    
    - **便捷操作**: 提供“清除筛选”按钮，一键重置所有高级筛选条件。

### 🎯 视觉识别与交互
- **实时标识**: 在 X.com 的搜索结果中，特别关注用户的推文旁会显示醒目的金色⭐徽章。

- **状态同步**: 添加或移除特别关注后，用户主页上的星标按钮状态会实时更新。

- **动态页面适应**: 插件能够更好地适应 X.com 的动态内容加载和单页应用（SPA）的路由变化。

### 🎨 Apple Design 风格界面
- **现代设计**: 采用借鉴 Apple Design 的设计语言，追求简洁与优雅。

- **毛玻璃效果**: 半透明背景配合 `backdrop-filter` 模糊效果，提升视觉质感。

- **流畅动画**: 丰富的过渡动画和交互反馈，操作更自然。

- **深色模式**: 自动适应操作系统的深色或浅色主题设置。

- **响应式布局**: 面板设计能够适配不同屏幕尺寸，确保良好体验。

## 🚀 安装方法
### Chrome/Edge (推荐)
1. 下载插件源码 (`.zip` 或 `git clone`) 并解压到本地一个方便的文件夹。

2. 打开浏览器，访问 `chrome://extensions/` (Chrome) 或 `edge://extensions/` (Edge)

3. 在右上角开启"开发者模式"

4. 点击"加载已解压的扩展程序"

5. 选择插件文件夹

6. 安装完成！插件图标将出现在工具栏

### Firefox

1. 下载插件源码 (`.zip` 或 `git clone`) 并解压到本地一个方便的文件夹。

2. 打开 Firefox，访问 `about:debugging`

3. 点击左侧"此 Firefox"

4. 点击"临时载入附加组件..."

5. 选择 `manifest.json` 文件

6. 安装完成！

> **注意**: 在 Firefox 中通过此方式安装是临时的，浏览器重启后需要重新加载。要永久安装，需要将插件打包为 .xpi 文件并签名。

## 📖 使用指南

### 1. 打开/关闭搜索面板
- 在任何 X.com 页面，点击浏览器工具栏中的插件图标即可打开或关闭页面右侧的搜索增强面板。

- 面板的打开/关闭状态会被记住。

### 2. 添加/移除特别关注用户
1. 访问任何 X 用户的主页（例如：`https://x.com/elonmusk`）。

2. 在目标用户名的旁边，您会看到一个星标按钮。该按钮会根据您的关注状态显示不同：☆ 表示尚未关注，⭐ 表示已设为特别关注。

3. 点击此星标按钮即可添加或移除该用户的特别关注。

### 3. 使用高级搜索筛选

1. 在搜索面板中，找到位于主关键词输入框下方的 “高级筛选 ▼” 按钮。

2. 点击此按钮可以展开或收起高级筛选条件区域。

3. 在展开的区域内，您可以根据需要设置一个或多个筛选条件：

    - **指定用户**: 输入一个X用户名。

    - **日期范围**: 使用日期选择器选择开始和/或结束日期。

    - **内容类型**: 勾选相应的复选框（如“认证用户”、“包含图片”等）。

    - **语言**: 从下拉列表中选择一种语言。

    - **排除回复**: 勾选“排除回复”复选框。

4. 设置完毕后，这些筛选条件将与主关键词和“特别关注”列表（如果已激活）结合进行搜索。

5. 点击“清除筛选”按钮可以快速重置所有高级筛选条件。

### 4. 执行搜索

1. 在搜索面板的输入框中输入关键词

2. 根据需要设置“特别关注”用户列表和“高级搜索筛选”条件。

3. 点击面板底部的"开始搜索"按钮。

4. 插件将自动构建包含所有选定条件的精确搜索查询，并跳转到 X.com 的搜索结果页面。

### 5. 管理特别关注用户
- **查看列表**: 搜索面板中会显示所有已添加的特别关注用户。

- **快速访问**: 点击列表中的任意用户项，可以直接在新标签页中打开该用户的主页。

- **移除用户**: 点击用户项右侧的 × 按钮，可以将该用户从特别关注列表中移除。

### 6. 识别搜索结果
- 在 X.com 的搜索结果页面，来自您特别关注用户的推文，其用户名旁边会显示一个金色的 ⭐ 徽章，方便快速识别。

## 🏗️ 技术架构 (v1.1.0 优化后)
### 📁 文件结构
```
x-search-enhancer/
├── manifest.json           # 插件配置文件 (Manifest V3)
├── service_worker.js       # 后台服务工作者 (事件处理、通信协调)
├── content_script.js       # 内容脚本 (核心逻辑、DOM操作、UI注入)
├── content_styles.css      # 样式文件 (插件UI及注入元素的样式)
├── icons/                  # 插件图标 (不同尺寸)
│   ├── icon16.png
│   ├── icon32.png
│   ├── icon48.png
│   └── icon128.png
└── README.md               # 项目文档
```

### 🔧 核心技术与优化亮点
- **Manifest V3**: 遵循最新的浏览器扩展标准，提升安全性与性能。

- **Service Worker**: 高效处理后台事件，如插件图标点击和与内容脚本的通信。
    - **通信优化 (模块7)**: 改进了与内容脚本的通信机制，能更健壮地处理脚本注入和消息传递。

- **Content Script**:
    - **健壮的DOM交互层 (模块1)**:
        - `DOM_SELECTORS`: 集中管理所有CSS选择器，便于维护和应对X.com的UI变更。

        - `findElementAdvanced`: 实现了高级元素查找函数，利用 `MutationObserver` 动态等待元素加载，取代了不可靠的固定延时。

    - **动态内容加载处理 (模块2)**: 扩展的初始化和关键功能执行现在依赖于页面实际内容的加载状态，而非固定延时。

    - **一致的面板状态管理 (模块3)**: 引入了专门的状态管理函数 (`setPanelOpenState`)，确保面板的打开/关闭状态在本地缓存和 `chrome.storage.local` 中准确同步。

    - **增强的按钮添加逻辑 (模块4)**: 优化了在用户个人资料页添加“特别关注”按钮的逻辑，提高了准确性和鲁棒性。

- **Chrome Storage API**: 用于在本地持久化存储用户的特别关注列表和面板的打开/关闭状态。

- **CSS策略优化 (模块5)**: 审查并优化了CSS，通过提高选择器特异性减少了不必要的 `!important` 使用，同时保留了确保UI稳定性的关键 `!important` 规则。

- **Manifest 文件清理 (模块6)**: 清理了 `manifest.json`，移除了 `web_accessible_resources` 中未使用的文件声明。

- **模块化设计**: 通过将功能点拆分为逻辑模块进行优化，提高了代码的可读性和可维护性。

### 🎨 样式系统
- **模块化CSS**: 样式规则与组件功能相对应。

- **CSS自定义属性 (Variables)**: 便于主题定制和实现深色/浅色模式的自动切换。

- **响应式设计**: 确保在不同屏幕尺寸和设备上均有良好视觉和操作体验。

- **流畅动画**: 使用CSS动画和过渡效果，提升用户交互的平滑感。

- **无障碍支持**: 考虑了高对比度模式和减少动画的偏好设置。

## 🛡️ 权限说明

插件请求的权限及其用途：

- **`storage`**: 用于在用户本地浏览器中存储特别关注用户列表及插件设置（如面板打开状态）。

- **`activeTab`**: 主要用于在用户点击插件图标时与当前活动的X.com标签页进行交互（例如发送消息以切换面板）。

- **`scripting`**: 用于向X.com页面动态注入内容脚本 (`content_script.js`) 和样式 (`content_styles.css`)。

- **`host_permissions`**: (`*://x.com/*`, `*://twitter.com/*`) 明确声明插件仅在X.com及其旧域名twitter.com下工作，确保插件只在相关网站上运行。

> **隐私承诺**: 所有用户数据（如特别关注列表）仅存储在用户本地的浏览器存储中，插件不会收集、存储或将任何用户数据上传到任何外部服务器。

## 🔧 自定义主题 (通过CSS变量)

插件的视觉主题（如颜色、圆角等）主要通过CSS自定义属性（变量）在 `content_styles.css` 的 `:root` 选择器中定义。您可以修改这些变量值来自定义插件的外观。

示例变量：
```css
:root {
  --primary-blue: #007AFF;        /* 主色调 */
  --background-primary: rgba(255, 255, 255, 0.95); /* 面板主背景 */
  /* ... 更多变量 ... */
}
```

## ❗ 故障排除

### 插件图标显示感叹号 (\!)

- **原因**: 通常表示您当前所在的浏览器标签页不是 X.com 或 twitter.com 域名。

- **解决**: 请确保在 X.com 或 twitter.com 网站上使用本插件。如果在非这些网站点击图标，插件会禁用面板持久化状态。

### 用户个人资料页找不到添加/移除特别关注的星标按钮

- **原因**:
  
  1.  X.com 的页面HTML结构可能发生了变化，导致插件无法定位到正确的用户名位置。

  2.  页面内容可能尚未完全加载完毕。

- **解决**:
  
  1.  尝试刷新页面，等待页面元素完全加载。

  2.  如果问题持续存在，这可能意味着插件内部用于定位元素的CSS选择器需要更新。您可以关注插件的更新，或在开发者工具中检查控制台是否有相关警告信息（如 "Username line container not found"）。

### 面板无法打开或行为异常

  - **原因**:
    
    1.  内容脚本可能未能正确加载或初始化。

    2.  浏览器扩展上下文可能已失效（例如，在插件更新或浏览器重启的瞬间）。

  - **解决**:
    
    1.  尝试刷新 X.com 页面。

    2.  检查浏览器右上角的插件图标是否正常，没有显示错误。

    3.  在浏览器的扩展管理页面 (`chrome://extensions/`) 尝试禁用再重新启用本插件。

    4.  检查浏览器开发者工具的控制台（Console）中是否有与本插件相关的错误信息。

### 高级筛选条件不生效或显示不正确
  
  - **原因**:
    
    1.  **状态未正确保存/加载**: 可能是 `chrome.storage.local` 读写出现问题，或者状态更新逻辑有误。

    2.  **日期范围无效**: 开始日期晚于结束日期，此时搜索不会执行。

    
    3.  **`from:username` 显隐逻辑冲突**: 如果“特别关注”列表状态未能正确同步到高级筛选UI。
    4.  **与其他扩展冲突**: 极少数情况下，其他浏览器扩展可能干扰本插件的DOM操作或存储。
  
  - **解决**:
  
    1.  **检查控制台**: 查看浏览器开发者工具的控制台是否有与高级筛选相关的错误或警告信息。
  
    2.  **清除筛选**: 尝试点击高级筛选区域内的“清除筛选”按钮，然后重新设置。
  
    3.  **检查日期**: 确保开始日期不晚于结束日期。面板应有错误提示。
  
    4.  **检查“特别关注”列表**: 确认“特别关注”列表的状态是否与预期一致，以及 `from:username` 字段是否按预期显示或隐藏。
  
    5.  **禁用其他扩展**: 临时禁用其他浏览器扩展，看是否解决问题，以排除冲突。
  
    6.  **重置插件**: 在扩展管理页面禁用再启用本插件，或在极端情况下，卸载后重新安装（注意：这可能会清除已保存的特别关注用户和设置）。

## 🔄 更新日志

### v1.2.0 (内部代号: "Precision Search Update" - 2025-06-02) 

- ✨ **集成高级搜索筛选条件**
    
    - 在搜索面板中增加了可展开/收起的“高级筛选”区域。

    - 支持按指定用户 (`from:username`) 搜索（当“特别关注”未激活时）。

    - 支持按日期范围 (`since:`, `until:`) 筛选。

    - 支持按内容类型筛选：认证用户 (`filter:verified`)、图片 (`filter:images`)、视频 (`filter:videos`)、链接 (`filter:links`)。

    - 支持按语言筛选（中文、英语、日语、韩语）。

    - 支持排除回复 (`-filter:replies`)。

- 🔧 **功能改进与优化 (高级搜索相关)**:
    
    - 当“特别关注”列表激活时，高级筛选中的“指定用户”输入区域会自动隐藏。
    
    - 高级筛选条件的展开/收起状态及各筛选值会通过 `chrome.storage.local` 进行持久化存储。
    
    - 增加了“清除筛选”按钮，可一键重置所有高级筛选条件。
    
    - 实现了日期范围的有效性校验。
    
    - 优化了 `content_script.js` 的代码结构，将高级筛选UI的生成和逻辑处理模块化。
    
    - 在 `content_styles.css` 中为高级筛选区域添加了新样式，并实现了展开/收起的动画效果。

- 🐛 **问题修复**:
    
    - (如果有针对此版本修复的其他小问题，可在此列出)

### v1.1.0 (内部代号: "Robustness & Stability Update" - 2025-06-02)

  - **模块 1: 健壮的DOM交互层**
      - 引入 `DOM_SELECTORS` 对象集中管理CSS选择器。

      - 实现 `findElementAdvanced` 函数，使用 `MutationObserver` 动态等待元素加载，替换固定延时。

  - **模块 2: 动态内容加载处理器**
      - 优化扩展初始化逻辑，确保在页面关键内容加载完成后再启动核心功能。

  - **模块 3: 一致的面板状态和生命周期管理**

      - 实现 `setPanelOpenState` 函数，统一管理面板打开/关闭状态及其在 `chrome.storage.local` 中的持久化。

      - 优化了面板在SPA导航和页面刷新时的状态恢复逻辑。

  - **模块 4: `addUserProfileButton` 功能增强**
      - 改进 `isUserProfilePage` 函数，更准确地识别用户个人资料页并提取用户名。

      - 确保只在正确的用户页添加“特别关注”按钮，并在导航离开时清理残留按钮。

  - **模块 5: CSS 策略优化**
      - 审查并优化 `content_styles.css`，通过提高选择器特异性减少了不必要的 `!important` 使用。

  - **模块 6: Manifest 文件清理**
      - 清理 `manifest.json`，移除了 `web_accessible_resources` 中未使用的文件声明。

  - **模块 7: Service Worker - 内容脚本通信优化**
      - 改进 `service_worker.js` 与内容脚本的通信，利用 Promise 更健壮地处理脚本注入和消息传递。

  - **其他**: 修复了若干小问题，提升了代码的整体稳定性和可维护性。

### v1.0.0 (初始版本)

- 🎉 **首次发布**: 实现核心MVP功能。

- ⭐ **特别关注管理**: 支持添加、移除、列表管理特别关注用户。

- 🔍 **智能搜索**: 支持基于特别关注用户的内容搜索。

- 🎨 **Apple Design风格**: 引入现代化界面设计。

- 🌙 **深色模式**: 自动适应系统主题。

- 📱 **响应式设计**: 初步支持不同屏幕尺寸。

- 🚀 **Manifest V3**: 基于最新的扩展标准构建。

## 🤝 贡献指南

我们欢迎任何形式的贡献，包括功能建议、Bug报告或代码提交！

### 开发环境要求

- 现代浏览器 (推荐 Chrome 88+, Edge 88+, Firefox 89+)。

- 对 JavaScript, CSS, HTML 和浏览器扩展开发有基本了解。

### 参与方式

1.  **Fork** 本项目到您的 GitHub 账户。

2.  创建一个新的功能分支 (例如: `git checkout -b feature/YourAmazingFeature`)。

3.  提交您的代码更改 (`git commit -m 'Add some YourAmazingFeature'`)。

4.  将您的分支推送到您的 Fork 仓库 (`git push origin feature/YourAmazingFeature`)。

5.  创建一个 **Pull Request** 到本项目的主分支。

### 代码规范

- 请尽量遵循项目中现有的代码风格和结构。

- 为新增或修改的功能添加必要的注释。

- 确保代码在主流浏览器上的兼容性。

## 📄 开源协议

本项目采用 [GPL-3.0 License](LICENSE) 开源协议。

## 💬 反馈与支持

如果您在使用过程中遇到问题或有改进建议，欢迎：

- 提交 [Issue](../../issues)

- 发起 [Pull Request](../../pulls)

- 分享使用体验

---

**感谢使用 X 搜索增强插件！** 🎉

如果这个插件对您有帮助，请考虑给项目点个 ⭐ Star！